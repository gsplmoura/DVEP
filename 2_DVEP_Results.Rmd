---
title: "DVEP_2_Analysis"
author: "Moura, G.S.P.L"
date: "2025-01-07"
output: html_document
---

```{r}

```

# Baseline

```{r, echo= FALSE, results='hide'}
max(data_d1_exclusive$record_id) # Número de participantes
summary(data_d1_exclusive$sex); (65/75)*100 # Tabela de frequência de sexo e porcentagem do sexo feminino
mean(data_d1_exclusive$age); sd(data_d1_exclusive$age) # Idade (média e DP)
```

Um total de 75 participantes de pesquisa foram incluídos neste estudo, sendo 65 (86,6%) do sexo feminino. A média da idade dos participantes foi de 40,6 anos (DP 10,2 anos). A tabela 1 contem as características de base participantes de pesquisa, antes do início da intervenção. Os participantes foram incluídos no estudo entre 09/08/2023 e 26/07/2024. As datas em que os participantes completaram a intervenção foram entre 14/11/2023 e 25/10/2024.

```{r}
# Datas de inclusão e conclusão
summary(data$consent_date)
summary(data$conclusion_date)

# Completaram a intervenção
summary(data_d1_exclusive$completed_intervention)
```


## Abandonos
Dos participantes incluídos, 23 (30.6%) não completaram os três meses de intervenção. A taxa de abandono foi maior nos homens, com 4 abandonos (40% dos homens incluídos), sendo 2 de cada grupo. No sexo feminino, a taxa de abandono foi de 29.2%, sendo oito do grupo placebo e 11 do grupo intervenção.

```{r}
# Abandonos
## Taxa de abandono
(23/75)*100 

## Abandono por sexo e grupo de alocação
data_d1_exclusive |> 
    filter(completed_intervention == "Não") |> 
    count(sex, allocation_group, name = "Total")

## Taxa de abandono por sexo
(4/10)*100 # Homens
(19/65)*100 # Mulheres

table(data$non_completion_reason)
```

## Participant's characteristics (data_d1_exclusive)
```{r}
# ALL
baseline_num <- summarize_numerical(data_d1_exclusive) # `summarize_numerical()`
baseline_num %>%
  gt() %>%
  tab_header(
    title = "Numerical Variable Summary",
    subtitle = "Overall Summary"
  )

baseline_cat <- summarize_categorical(data_d1_exclusive) # `summarize_categorical()`
baseline_cat %>%
  gt() %>%
  tab_header(
    title = "Categorical Variable Summary",
    subtitle = "Overall Summary"
  )

# BY GROUP
baseline_num_group <- summarize_numerical(data_d1_exclusive, "allocation_group") # `summarize_numerical()`
baseline_num_group %>%
  gt() %>%
  tab_header(
    title = "Numerical Variable Summary",
    subtitle = "Overall Summary"
  )

baseline_cat_group <- summarize_categorical(data_d1_exclusive, "allocation_group") # `summarize_categorical()`
baseline_cat_group %>%
  gt() %>%
  tab_header(
    title = "Categorical Variable Summary",
    subtitle = "Overall Summary"
  )

# COMPARE GROUPS
group_comparison <- compare_groups(data_d1_exclusive) #`compare_groups`
print(group_comparison)
```

**Clear** Participant's characteristics (data_d1_exclusive)
```{r, eval=FALSE}
# CLEAR
rm(baseline_num)
rm(baseline_cat)
rm(baseline_num_group)
rm(baseline_cat_group)
rm(group_comparison)
```

Comparação da proporção do sexo dos participantes segundo o grupo de alocação
Na verdade essa análise foi redundante - já foi feita em `baseline_cat_group`
```{r, eval=FALSE}
group_by_sex <- data_d1_exclusive |> 
    group_by(sex, allocation_group) |> 
    count() |> 
    pivot_wider(names_from = allocation_group, values_from = n, values_fill = 0) |>
    column_to_rownames(var = "sex") |> # Converts the 'sex' column into row names
    as.matrix()

group_by_sex_chisq <- chisq.test(group_by_sex)
group_by_sex_chisq
group_by_sex_FET <- fisher.test(group_by_sex)
group_by_sex_FET

rm(group_by_sex)
rm(group_by_sex_chisq)
rm(group_by_sex_FET)
```


## Lab exames
```{r}
# filter first visit and relevant variables
labs_baseline <- I27_labs_R |> 
    filter(
        visit == 1
    ) |> 
    select(
        -visit, -labs_date, -labs_beta_hcg , -labs_notes
    ) |> left_join(
        data_d1_exclusive |> 
            select(record_id, allocation_group),
                   by = "record_id"
                  )

baseline_labs_baseline <- summarize_numerical(labs_baseline) #all
baseline_labs_baseline_groups <- summarize_numerical(labs_baseline,"allocation_group") #groups
baseline_labs_baseline_groups_compare <- compare_groups(labs_baseline) #compare
print(baseline_labs_baseline_groups_compare) #print
```

**Clear** Lab exams
```{r, eval=FALSE}
rm(baseline_labs_baseline)
rm(baseline_labs_baseline_groups)
rm(baseline_labs_baseline_groups_compare)
```

**CPR**
```{r}

plot(labs_baseline$labs_crp)

cpr_bp <- boxplot(labs_baseline$labs_crp_log)
cpr_bp$out

par(mfrow = c(1, 2)) 
hist(labs_baseline$labs_crp)
hist(labs_baseline$labs_crp_log)

labs_baseline$labs_crp_log <- log(labs_baseline$labs_crp)

summary(labs_baseline$labs_crp_log)

plot(labs_baseline$labs_crp_log, data_filtered$phaseangle[data_filtered$visit == 1])


skim(labs_baseline)
```


## BIA
```{r}
bia_baseline <- data_bia |>
    filter(
        visit == 1
    ) |> 
    select(
        record_id, phaseangle:w_ecw
        ) |> 
    left_join(
        data_d1_exclusive |> 
            select(record_id, allocation_group, sex),
                   by = "record_id"
        )

#by sex
bia_baseline_sex <- summarize_numerical(bia_baseline, "sex") 
bia_baseline_sex_compare <- compare_groups(bia_baseline,"sex") # compare
print(bia_baseline_sex_compare) # print

# by groups, by sex
## males
bia_baseline_males <- bia_baseline |> 
    filter(
        sex == "Masculino"
    )
bia_baseline_males_groups <- summarize_numerical(bia_baseline_males, "allocation_group") #males, by group
bia_baseline_males_groups_compare <- compare_groups(bia_baseline_males) #males, comapre
print(bia_baseline_males_groups_compare)

## females
bia_baseline_females <- bia_baseline |> 
    filter(
        sex == "Feminino"
    )
bia_baseline_females_groups <- summarize_numerical(bia_baseline_females, "allocation_group") #females, by group
bia_baseline_females_groups_compare <- compare_groups(bia_baseline_females) #females, compare
print(bia_baseline_females_groups_compare)

```

**Clear** BIA
```{r, eval=FALSE}
rm(bia_baseline)
rm(bia_baseline_all)
rm(bia_baseline_groups)
rm(bia_baseline_compare)
```


**Clear**
```{r, eval=FALSE}
rm()
rm()
rm()
rm()
rm()
```


**Clear**
```{r, eval=FALSE}
rm()
rm()
rm()
rm()
rm()
```


**Clear**
```{r, eval=FALSE}
rm()
rm()
rm()
rm()
rm()
```


**Clear**
```{r, eval=FALSE}
rm()
rm()
rm()
rm()
rm()
```



